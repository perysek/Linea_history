{% extends 'base.html' %}

{% block title %}Wykaz zablokowanych detali - LINEA{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/linea.css') }}">
{% endblock %}

{% block content %}
<div class="refined-page fade-in">
    <!-- Page Header -->
    <header class="page-header">
        <h1 class="page-title">Wykaz zablokowanych detali</h1>
    </header>

    <!-- Combined Filter Pills and Summary -->
    <div class="filters-container">
        <!-- Summary Pills -->
        <div class="filter-pills">
            <span class="filter-pill active" id="row-count">0 pozycji</span>
            <span class="filter-pill" id="total-blocked-pill"
                  style="background: #fee2e2; color: #991b1b; border-color: #fecaca;">
                0 szt. zablokowanych
            </span>
        </div>

        <!-- Clear Filters Button -->
        <button type="button" class="btn-clear-filters" id="btn-clear-filters"
                onclick="clearAllFilters()" style="display: none;">
            <svg width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
            Usuń filtry
        </button>
    </div>

    <!-- Table Container -->
    <div class="table-container">
        <div class="table-scroll-wrapper">
            <!-- Fixed Header Table -->
            <table class="refined-table" style="flex-shrink: 0;">
                <colgroup>
                    <col style="width: 12%;">  <!-- KOD_DETALU -->
                    <col style="width: 10%;">  <!-- NR_NIEZG -->
                    <col style="width: 9%;">   <!-- DATA_NIEZG -->
                    <col style="width: 40%;">  <!-- OPIS_NIEZG -->
                    <col style="width: 12%;">  <!-- PRODUCED -->
                    <col style="width: 8%;">   <!-- ILOSC_OPAKOWAN -->
                    <col style="width: 9%;">   <!-- ILOSC_ZABL -->
                </colgroup>
                <thead>
                    <tr>
                        <th class="sortable">
                            <div class="th-content">
                                <div class="th-header" onclick="sortTable('KOD_DETALU')" style="cursor: pointer;">
                                    <span>Kod detalu</span>
                                    <svg class="sort-icon" width="12" height="12" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4" />
                                    </svg>
                                </div>
                                <input type="text" class="column-search" placeholder="Szukaj..." data-column="KOD_DETALU">
                            </div>
                        </th>
                        <th class="sortable">
                            <div class="th-content">
                                <div class="th-header" onclick="sortTable('NR_NIEZG')" style="cursor: pointer;">
                                    <span>Nr NC</span>
                                    <svg class="sort-icon" width="12" height="12" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4" />
                                    </svg>
                                </div>
                                <input type="text" class="column-search" placeholder="Szukaj..." data-column="NR_NIEZG">
                            </div>
                        </th>
                        <th class="sortable">
                            <div class="th-content">
                                <div class="th-header" onclick="sortTable('DATA_NIEZG')" style="cursor: pointer;">
                                    <span>Data NC</span>
                                    <svg class="sort-icon" width="12" height="12" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4" />
                                    </svg>
                                </div>
                                <input type="text" class="column-search" placeholder="Szukaj..." data-column="DATA_NIEZG">
                            </div>
                        </th>
                        <th>
                            <div class="th-content">
                                <div class="th-header">
                                    <span>Opis niezgodności</span>
                                </div>
                                <input type="text" class="column-search" placeholder="Szukaj..." data-column="OPIS_NIEZG">
                            </div>
                        </th>
                        <th class="sortable">
                            <div class="th-content">
                                <div class="th-header" onclick="sortTable('PRODUCED')" style="cursor: pointer;">
                                    <span>Produced</span>
                                    <svg class="sort-icon" width="12" height="12" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4" />
                                    </svg>
                                </div>
                            </div>
                        </th>
                        <th class="sortable">
                            <div class="th-content">
                                <div class="th-header" onclick="sortTable('ILOSC_OPAKOWAN')" style="cursor: pointer;">
                                    <span style="text-align: right;">opakowań</span>
                                    <svg class="sort-icon" width="12" height="12" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4" />
                                    </svg>
                                </div>
                            </div>
                        </th>
                        <th class="sortable">
                            <div class="th-content">
                                <div class="th-header" onclick="sortTable('ILOSC_ZABL')" style="cursor: pointer;">
                                    <span style="text-align: right;">sztuk</span>
                                    <svg class="sort-icon" width="12" height="12" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4" />
                                    </svg>
                                </div>
                                <div id="filtered-sum-box"
                                     style="display: none; padding: 0.25rem 0.5rem; background: #eeeeee;
                                            border-radius: 2px; text-align: right; font-size: 0.6875rem;
                                            font-weight: 500; color: #525252; text-transform: none;
                                            letter-spacing: normal;">
                                    Suma filtry:
                                    <span id="total-blocked-qty" style="color: #991b1b; font-weight: 600;">0</span> szt.
                                </div>
                            </div>
                        </th>
                    </tr>
                </thead>
            </table>

            <!-- Scrollable Body -->
            <div class="tbody-scroll">
                <table class="refined-table">
                    <colgroup>
                        <col style="width: 12%;">  <!-- KOD_DETALU -->
                        <col style="width: 10%;">  <!-- NR_NIEZG -->
                        <col style="width: 9%;">   <!-- DATA_NIEZG -->
                        <col style="width: 40%;">  <!-- OPIS_NIEZG -->
                        <col style="width: 12%;">  <!-- PRODUCED -->
                        <col style="width: 8%;">   <!-- ILOSC_OPAKOWAN -->
                        <col style="width: 9%;">   <!-- ILOSC_ZABL -->
                    </colgroup>
                    <tbody id="blocked-tbody">
                        <tr>
                            <td colspan="7" style="text-align: center; padding: 2rem; color: var(--color-ink-muted);">
                                Ładowanie...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Pagination Bar -->
        <div class="pagination-bar">
            <span class="pagination-info">
                Wyświetlono <span class="pagination-count" id="visible-count">0</span>
                z <span class="pagination-count" id="total-count">0</span> rekordów
            </span>
            <span class="scroll-loading-indicator" id="scroll-loading-indicator">
                <svg width="13" height="13" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                </svg>
                Ładowanie kolejnych rekordów...
            </span>
        </div>
    </div>

    <!-- Boxes Details Modal -->
    <div id="boxes-modal" class="modal-overlay" onclick="closeModalOnBackdrop(event)">
        <div class="modal-container">
            <div class="modal-header">
                <div>
                    <h2 class="modal-title">Szczegóły opakowań</h2>
                    <p class="modal-subtitle">Nr niezgodności: <span id="modal-nc-number"></span></p>
                </div>
                <button class="modal-close-btn" onclick="closeBoxesModal()">
                    <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div class="modal-body" id="modal-body">
                <div class="modal-loading">Ładowanie...</div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script src="{{ url_for('static', filename='js/wykaz_zablokowanych.js') }}"></script>
{% endblock %}
